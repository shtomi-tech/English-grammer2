<!-- 第4文型の受動態 - 能動態と受動態の書き換え練習問題 -->
<div class="apple-card mb-8">
    <h2 class="apple-card-title flex items-center">
        <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        第4文型の受動態 - 能動態と受動態の書き換え練習
    </h2>
    
    <div class="mb-6">
        <p class="text-gray-700 mb-4">
            以下の文を書き換えてください。空欄に適切な語句を入力してください。
        </p>
    </div>

    <div id="active-passive-questions" class="space-y-6">
        <!-- 問題1 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 1</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">I was given this watch by my father.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <input type="text" class="answer-input-full" data-correct="My father gave me this watch." placeholder="能動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>My father gave me this watch.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の受動態「was given」を過去形の能動態「gave」に書き換えます。第4文型では間接目的語（me）と直接目的語（this watch）の順序に注意します。
                </p>
            </div>
        </div>

        <!-- 問題2 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 2</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">An interesting story was told to him by her.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <input type="text" class="answer-input-full" data-correct="She told him an interesting story." placeholder="能動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>She told him an interesting story.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の受動態「was told」を過去形の能動態「told」に書き換えます。第4文型では間接目的語（him）と直接目的語（an interesting story）の順序に注意します。
                </p>
            </div>
        </div>

        <!-- 問題3 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 3</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">The teacher showed us some old maps.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                    <p class="text-yellow-800 text-sm"><strong>ヒント：</strong>人（間接目的語）を主語にする受動態に書き換えてください。</p>
                </div>
                <input type="text" class="answer-input-full" data-correct="We were shown some old maps by the teacher." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>We were shown some old maps by the teacher.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「showed」を過去形の受動態「were shown」に書き換えます。第4文型では間接目的語（us）を主語にした受動態になります。
                </p>
            </div>
        </div>

        <!-- 問題4 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 4</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">John gave Mary a book.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                    <p class="text-yellow-800 text-sm"><strong>ヒント：</strong>物（直接目的語）を主語にする受動態に書き換えてください。</p>
                </div>
                <input type="text" class="answer-input-full" data-correct="A book was given to Mary by John." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>A book was given to Mary by John.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「gave」を過去形の受動態「was given」に書き換えます。第4文型では直接目的語（a book）を主語にした受動態になり、間接目的語には「to」を付けます。
                </p>
            </div>
        </div>

        <!-- 問題5 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 5</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">He bought his daughter a new dress.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                    <p class="text-yellow-800 text-sm"><strong>ヒント：</strong>物（直接目的語）を主語にする受動態に書き換えてください。</p>
                </div>
                <input type="text" class="answer-input-full" data-correct="A new dress was bought for his daughter by him." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>A new dress was bought for his daughter by him.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「bought」を過去形の受動態「was bought」に書き換えます。第4文型では直接目的語（a new dress）を主語にした受動態になります。
                </p>
            </div>
        </div>
    </div>

    <!-- 結果表示 -->
    <div id="practice-results" class="hidden mt-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200">
        <h3 class="text-xl font-bold text-gray-800 mb-4">練習結果</h3>
        <div class="flex items-center justify-between mb-4">
            <span class="text-lg">正解数：<span id="correct-count" class="font-bold text-green-600">0</span> / 5</span>
            <span class="text-lg">正答率：<span id="accuracy-rate" class="font-bold text-blue-600">0%</span></span>
        </div>
        <div class="text-sm text-gray-600">
            <p id="result-message"></p>
        </div>
    </div>

    <!-- リセットボタン -->
    <div class="mt-6 text-center">
        <button id="reset-practice" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded transition-colors">
            練習をリセット
        </button>
    </div>
</div>

<style>
.answer-input-full {
    border: 2px solid #e5e7eb;
    border-radius: 0.375rem;
    padding: 0.75rem;
    font-size: 1rem;
    width: 100%;
    transition: border-color 0.2s;
    color: #000000;
}

.answer-input-full:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    color: #000000;
}

.answer-input-full.correct {
    border-color: #10b981;
    background-color: #f0fdf4;
    color: #000000;
}

.answer-input-full.incorrect {
    border-color: #ef4444;
    background-color: #fef2f2;
    color: #000000;
}

.answer-input-full::placeholder {
    color: #6b7280;
}

.question-card {
    transition: transform 0.2s;
}

.question-card:hover {
    transform: translateY(-2px);
}
</style>

<script>
// 即座に実行する関数
(function() {
    // DOMが完全に読み込まれるまで少し待つ
    setTimeout(function() {
        const checkButtons = document.querySelectorAll('.check-answer-btn');
        const resetButton = document.getElementById('reset-practice');
        const resultsDiv = document.getElementById('practice-results');
        let answeredQuestions = new Set();

        checkButtons.forEach(button => {
            button.addEventListener('click', function() {
                const questionCard = button.closest('.question-card');
                const input = questionCard.querySelector('.answer-input-full');
                const explanation = questionCard.querySelector('.answer-explanation');
                const correctAnswer = input.dataset.correct;
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswerLower = correctAnswer.toLowerCase();

                // 既に回答済みの場合は何もしない
                if (answeredQuestions.has(questionCard)) {
                    return;
                }

                // 正解判定
                if (userAnswer === correctAnswerLower) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                }

                // 全問回答済みの場合、結果を表示
                if (answeredQuestions.size === 5) {
                    showResults();
                }
            });
        });

        if (resetButton) {
            resetButton.addEventListener('click', function() {
                // 入力フィールドをリセット
                document.querySelectorAll('.answer-input-full').forEach(input => {
                    input.value = '';
                    input.classList.remove('correct', 'incorrect');
                });

                // 解説を隠す
                document.querySelectorAll('.answer-explanation').forEach(explanation => {
                    explanation.classList.add('hidden');
                });

                // 結果を隠す
                if (resultsDiv) {
                    resultsDiv.classList.add('hidden');
                }

                // 回答済みセットをリセット
                answeredQuestions.clear();
            });
        }

        function showResults() {
            const correctCount = document.querySelectorAll('.answer-input-full.correct').length;
            const accuracy = Math.round((correctCount / 5) * 100);

            const correctCountElement = document.getElementById('correct-count');
            const accuracyRateElement = document.getElementById('accuracy-rate');
            const resultMessageElement = document.getElementById('result-message');

            if (correctCountElement) correctCountElement.textContent = correctCount;
            if (accuracyRateElement) accuracyRateElement.textContent = accuracy + '%';

            let message = '';
            if (accuracy === 100) {
                message = '素晴らしい！第4文型の受動態を完璧に理解できています。';
            } else if (accuracy >= 80) {
                message = 'とても良い成績です！第4文型の特徴を少し復習すれば完璧になります。';
            } else if (accuracy >= 60) {
                message = '基本的な理解はできています。第4文型の間接目的語と直接目的語の順序をもう少し練習しましょう。';
            } else {
                message = '基本から復習しましょう。第4文型の受動態では間接目的語と直接目的語の順序が重要です。';
            }

            if (resultMessageElement) resultMessageElement.textContent = message;
            if (resultsDiv) resultsDiv.classList.remove('hidden');
        }

        // Enterキーで回答確認
        document.querySelectorAll('.answer-input-full').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const button = this.closest('.question-card').querySelector('.check-answer-btn');
                    if (button) button.click();
                }
            });
        });
    }, 100); // 100ms待ってから実行
})();
</script> 