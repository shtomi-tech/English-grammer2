<!-- 第5文型の受動態 - 能動態と受動態の書き換え練習問題 -->
<div class="apple-card mb-8">
    <h2 class="apple-card-title flex items-center">
        <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        第5文型の受動態 - 能動態と受動態の書き換え練習
    </h2>
    <div class="mb-6">
        <p class="text-gray-700 mb-4">
            以下の文を書き換えてください。空欄に適切な語句を入力してください。
        </p>
    </div>
    <div id="active-passive-questions" class="space-y-6">
        <!-- 問題1 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 1</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">We call the dog Pochi.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <input type="text" class="answer-input-full" data-correct="The dog is called Pochi by us." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>The dog is called Pochi by us.</p>
                <p class="text-sm text-green-700 mt-1">
                    現在形の能動態「call」を現在形の受動態「is called」に書き換えます。第5文型では目的語（the dog）が主語になり、補語（Pochi）はそのまま残ります。
                </p>
            </div>
        </div>
        <!-- 問題2 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 2</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">The news made everyone happy.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <input type="text" class="answer-input-full" data-correct="Everyone was made happy by the news." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>Everyone was made happy by the news.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「made」を過去形の受動態「was made」に書き換えます。第5文型では目的語（everyone）が主語になり、補語（happy）はそのまま残ります。
                </p>
            </div>
        </div>
        <!-- 問題3 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 3</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">She kept the window locked.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <input type="text" class="answer-input-full" data-correct="The window was kept locked by her." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>The window was kept locked by her.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「kept」を過去形の受動態「was kept」に書き換えます。第5文型では目的語（the window）が主語になり、補語（locked）はそのまま残ります。
                </p>
            </div>
        </div>
        <!-- 問題4 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 4</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">The coach made them run for an hour.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                    <p class="text-yellow-800 text-sm"><strong>ヒント：</strong>目的語（them）を主語にして受動態に書き換えてください。使役動詞の受動態では原形不定詞がto不定詞になります。</p>
                </div>
                <input type="text" class="answer-input-full" data-correct="They were made to run for an hour by the coach." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>They were made to run for an hour by the coach.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「made」を過去形の受動態「were made」に書き換えます。使役動詞の受動態では原形不定詞「run」がto不定詞「to run」になります。
                </p>
            </div>
        </div>
        <!-- 問題5 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 5</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>能動態：</strong></p>
                <p class="text-lg font-medium text-blue-600">I saw him enter the building.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>受動態：</strong></p>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                    <p class="text-yellow-800 text-sm"><strong>ヒント：</strong>目的語（him）を主語にして受動態に書き換えてください。知覚動詞の受動態では原形不定詞がto不定詞になります。</p>
                </div>
                <input type="text" class="answer-input-full" data-correct="He was seen to enter the building by me." placeholder="受動態の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>He was seen to enter the building by me.</p>
                <p class="text-sm text-green-700 mt-1">
                    過去形の能動態「saw」を過去形の受動態「was seen」に書き換えます。知覚動詞の受動態では原形不定詞「enter」がto不定詞「to enter」になります。
                </p>
            </div>
        </div>
    </div>
    <!-- 結果表示 -->
    <div id="practice-results" class="hidden mt-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200">
        <h3 class="text-xl font-bold text-gray-800 mb-4">練習結果</h3>
        <div class="flex items-center justify-between mb-4">
            <span class="text-lg">正解数：<span id="correct-count" class="font-bold text-green-600">0</span> / 5</span>
            <span class="text-lg">正答率：<span id="accuracy-rate" class="font-bold text-blue-600">0%</span></span>
        </div>
        <div class="text-sm text-gray-600">
            <p id="result-message"></p>
        </div>
    </div>
    <!-- リセットボタン -->
    <div class="mt-6 text-center">
        <button id="reset-practice" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded transition-colors">
            練習をリセット
        </button>
    </div>
</div>

<style>
.answer-input-full {
    border: 2px solid #e5e7eb;
    border-radius: 0.375rem;
    padding: 0.75rem;
    font-size: 1rem;
    width: 100%;
    transition: border-color 0.2s;
    color: #000000;
}

.answer-input-full:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    color: #000000;
}

.answer-input-full.correct {
    border-color: #10b981;
    background-color: #f0fdf4;
    color: #000000;
}

.answer-input-full.incorrect {
    border-color: #ef4444;
    background-color: #fef2f2;
    color: #000000;
}

.answer-input-full::placeholder {
    color: #6b7280;
}

.question-card {
    transition: transform 0.2s;
}

.question-card:hover {
    transform: translateY(-2px);
}
</style>

<script>
// 即座に実行する関数
(function() {
    // DOMが完全に読み込まれるまで少し待つ
    setTimeout(function() {
        const checkButtons = document.querySelectorAll('.check-answer-btn');
        const resetButton = document.getElementById('reset-practice');
        const resultsDiv = document.getElementById('practice-results');
        let answeredQuestions = new Set();

        checkButtons.forEach(button => {
            button.addEventListener('click', function() {
                const questionCard = button.closest('.question-card');
                const input = questionCard.querySelector('.answer-input-full');
                const explanation = questionCard.querySelector('.answer-explanation');
                const correctAnswer = input.dataset.correct;
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswerLower = correctAnswer.toLowerCase();

                // 既に回答済みの場合は何もしない
                if (answeredQuestions.has(questionCard)) {
                    return;
                }

                // 正解判定
                if (userAnswer === correctAnswerLower) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                }

                // 全問回答済みの場合、結果を表示
                if (answeredQuestions.size === 5) {
                    showResults();
                }
            });
        });

        if (resetButton) {
            resetButton.addEventListener('click', function() {
                // 入力フィールドをリセット
                document.querySelectorAll('.answer-input-full').forEach(input => {
                    input.value = '';
                    input.classList.remove('correct', 'incorrect');
                });

                document.querySelectorAll('.answer-explanation').forEach(explanation => {
                    explanation.classList.add('hidden');
                });

                if (resultsDiv) {
                    resultsDiv.classList.add('hidden');
                }

                answeredQuestions.clear();
            });
        }

        function showResults() {
            const correctCount = document.querySelectorAll('.answer-input-full.correct').length;
            const accuracy = Math.round((correctCount / 5) * 100);

            const correctCountElement = document.getElementById('correct-count');
            const accuracyRateElement = document.getElementById('accuracy-rate');
            const resultMessageElement = document.getElementById('result-message');

            if (correctCountElement) correctCountElement.textContent = correctCount;
            if (accuracyRateElement) accuracyRateElement.textContent = accuracy + '%';

            let message = '';
            if (accuracy === 100) {
                message = '素晴らしい！第5文型の受動態を完璧に理解できています。';
            } else if (accuracy >= 80) {
                message = 'とても良い成績です！第5文型の受動態の基本は理解できています。';
            } else if (accuracy >= 60) {
                message = '基本的な理解はできています。第5文型の受動態の特徴をもう少し復習しましょう。';
            } else {
                message = '第5文型の受動態の基本から復習しましょう。目的語が主語になることと補語の扱いを理解することが大切です。';
            }

            if (resultMessageElement) resultMessageElement.textContent = message;
            if (resultsDiv) resultsDiv.classList.remove('hidden');
        }

        document.querySelectorAll('.answer-input-full').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const button = this.closest('.question-card').querySelector('.check-answer-btn');
                    if (button) button.click();
                }
            });
        });
    }, 200);
})();
</script> 