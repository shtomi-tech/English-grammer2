<!-- 第4文型から第3文型への書き換え練習問題 -->
<div class="apple-card mb-8">
    <h2 class="apple-card-title flex items-center">
        <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        第4文型から第3文型への書き換え練習
    </h2>
    
    <div class="mb-6">
        <p class="text-gray-700 mb-4">
            以下の第4文型の文を第3文型に書き換えてください。空欄に適切な語句を入力してください。
        </p>
    </div>

    <div id="pattern4-to-pattern3-questions" class="space-y-6">
        <!-- 問題1 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 1</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第4文型：</strong></p>
                <p class="text-lg font-medium text-blue-600">I gave him a book.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第3文型：</strong></p>
                <input type="text" class="answer-input-full" data-correct="I gave a book to him." placeholder="第3文型の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>I gave a book to him.</p>
                <p class="text-sm text-green-700 mt-1">
                    第4文型「gave him a book」を第3文型「gave a book to him」に書き換えます。間接目的語（him）の前に「to」を付けます。
                </p>
            </div>
        </div>

        <!-- 問題2 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 2</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第4文型：</strong></p>
                <p class="text-lg font-medium text-blue-600">She bought me a present.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第3文型：</strong></p>
                <input type="text" class="answer-input-full" data-correct="She bought a present for me." placeholder="第3文型の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>She bought a present for me.</p>
                <p class="text-sm text-green-700 mt-1">
                    第4文型「bought me a present」を第3文型「bought a present for me」に書き換えます。「buy」の場合は間接目的語の前に「for」を付けます。
                </p>
            </div>
        </div>

        <!-- 問題3 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 3</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第4文型：</strong></p>
                <p class="text-lg font-medium text-blue-600">The teacher told us a story.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第3文型：</strong></p>
                <input type="text" class="answer-input-full" data-correct="The teacher told a story to us." placeholder="第3文型の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>The teacher told a story to us.</p>
                <p class="text-sm text-green-700 mt-1">
                    第4文型「told us a story」を第3文型「told a story to us」に書き換えます。「tell」の場合は間接目的語の前に「to」を付けます。
                </p>
            </div>
        </div>

        <!-- 問題4 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 4</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第4文型：</strong></p>
                <p class="text-lg font-medium text-blue-600">He made his daughter a cake.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第3文型：</strong></p>
                <input type="text" class="answer-input-full" data-correct="He made a cake for his daughter." placeholder="第3文型の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>He made a cake for his daughter.</p>
                <p class="text-sm text-green-700 mt-1">
                    第4文型「made his daughter a cake」を第3文型「made a cake for his daughter」に書き換えます。「make」の場合は間接目的語の前に「for」を付けます。
                </p>
            </div>
        </div>

        <!-- 問題5 -->
        <div class="question-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-400">
            <h3 class="font-bold text-lg mb-4 text-gray-800">問題 5</h3>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第4文型：</strong></p>
                <p class="text-lg font-medium text-blue-600">They sent me a letter.</p>
            </div>
            <div class="mb-4">
                <p class="text-gray-700 mb-2"><strong>第3文型：</strong></p>
                <input type="text" class="answer-input-full" data-correct="They sent a letter to me." placeholder="第3文型の全文を入力してください">
            </div>
            <button class="check-answer-btn bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors">
                答えを確認
            </button>
            <div class="answer-explanation hidden mt-3 p-3 bg-green-50 border border-green-200 rounded">
                <p class="text-green-800"><strong>正解：</strong>They sent a letter to me.</p>
                <p class="text-sm text-green-700 mt-1">
                    第4文型「sent me a letter」を第3文型「sent a letter to me」に書き換えます。「send」の場合は間接目的語の前に「to」を付けます。
                </p>
            </div>
        </div>
    </div>

    <!-- リセットボタン -->
    <div class="mt-6 text-center">
        <button id="reset-practice" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded transition-colors">
            練習をリセット
        </button>
    </div>
</div>

<style>
.answer-input-full {
    border: 2px solid #e5e7eb;
    border-radius: 0.375rem;
    padding: 0.75rem;
    font-size: 1rem;
    width: 100%;
    transition: border-color 0.2s;
    color: #000000;
}

.answer-input-full:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    color: #000000;
}

.answer-input-full.correct {
    border-color: #10b981;
    background-color: #f0fdf4;
    color: #000000;
}

.answer-input-full.incorrect {
    border-color: #ef4444;
    background-color: #fef2f2;
    color: #000000;
}

.answer-input-full::placeholder {
    color: #6b7280;
}

.question-card {
    transition: transform 0.2s;
}

.question-card:hover {
    transform: translateY(-2px);
}
</style>

<script>
// 即座に実行する関数
(function() {
    // DOMが完全に読み込まれるまで少し待つ
    setTimeout(function() {
                                const checkButtons = document.querySelectorAll('.check-answer-btn');
                        const resetButton = document.getElementById('reset-practice');
                        let answeredQuestions = new Set();

        checkButtons.forEach(button => {
            button.addEventListener('click', function() {
                const questionCard = button.closest('.question-card');
                const input = questionCard.querySelector('.answer-input-full');
                const explanation = questionCard.querySelector('.answer-explanation');
                const correctAnswer = input.dataset.correct;
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswerLower = correctAnswer.toLowerCase();

                // 既に回答済みの場合は何もしない
                if (answeredQuestions.has(questionCard)) {
                    return;
                }

                // 正解判定
                if (userAnswer === correctAnswerLower) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                    explanation.classList.remove('hidden');
                    answeredQuestions.add(questionCard);
                }

                // 全問回答済みの場合、結果を表示
                                            // 全問回答済みの場合の処理を削除
            });
        });

        if (resetButton) {
            resetButton.addEventListener('click', function() {
                // 入力フィールドをリセット
                document.querySelectorAll('.answer-input-full').forEach(input => {
                    input.value = '';
                    input.classList.remove('correct', 'incorrect');
                });

                // 解説を隠す
                document.querySelectorAll('.answer-explanation').forEach(explanation => {
                    explanation.classList.add('hidden');
                });

                // 回答済みセットをリセット
                answeredQuestions.clear();
            });
        }

        // Enterキーで回答確認
        document.querySelectorAll('.answer-input-full').forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const button = this.closest('.question-card').querySelector('.check-answer-btn');
                    if (button) button.click();
                }
            });
        });
    }, 100); // 100ms待ってから実行
})();
</script> 


