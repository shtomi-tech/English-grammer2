<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語学習サイト (プロトタイプ)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SF Pro Display (Apple公式フォント) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=SF+Pro+Display:400,700&display=swap">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100">
    <!-- ヘッダー -->
    <header class="apple-header px-6 py-6 mb-8">
        <div class="container mx-auto flex flex-col items-start">
            <h1 class="apple-title">English Learning Hub</h1>
            <p class="apple-sub mt-2">英文法の基礎から学ぼう</p>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="container mx-auto px-6 py-8">
        
        <div class="max-w-4xl mx-auto">
            <!-- サイト紹介 -->
            <div class="apple-card mb-8">
                <h2 class="apple-card-title">このサイトについて</h2>
                <p class="apple-card-text">
                    このウェブサイトは、英語の基礎となる英文法を学ぶためのリソースです。<br>
                    各単元の解説を読み、練習問題に挑戦して理解を深めていきましょう。<br>
                    まずは下の「品詞」から始めてみてください。
                </p>
            </div>

            <!-- ナビゲーションボタン -->
            <div class="apple-card mb-8">
                <h2 class="apple-card-title">文法セクションへ移動</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="location.href='#partsofspeech'" class="apple-nav-btn">品詞</button>
                    <button onclick="location.href='#sentencepattern'" class="apple-nav-btn">文型</button>
                    <button onclick="location.href='#phrase'" class="apple-nav-btn">句</button>
                    <button onclick="location.href='#clause'" class="apple-nav-btn">節</button>
                    <button onclick="location.href='#tense'" class="apple-nav-btn">時制</button>
                    <button onclick="location.href='#modal'" class="apple-nav-btn">助動詞</button>
                    <button onclick="location.href='#subjunctive'" class="apple-nav-btn">仮定法</button>
                    <button onclick="location.href='#comparison'" class="apple-nav-btn">比較</button>
                </div>
            </div>

            <!-- 品詞 -->
            <section id="partsofspeech" class="apple-card mb-8">
                <h2 class="apple-card-title">品詞</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">名詞</h3>
                    <p class="apple-section-text">人・物・場所・考えなどを表す語。可算名詞と不可算名詞がある。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateNounQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiQuestionText" class="apple-question-text"></p>
                                <div id="aiOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">冠詞</h3>
                    <p>名詞の前に付けて特定・不特定を示す語。a/an（不特定）、the（特定）。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateArticleQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiArticleQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiArticleQuestionText" class="apple-question-text"></p>
                                <div id="aiArticleOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiArticleFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingArticleIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">be動詞</h3>
                    <p>主語の状態や存在を表す動詞。am/is/areがある。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateBeVerbQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiBeVerbQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiBeVerbQuestionText" class="apple-question-text"></p>
                                <div id="aiBeVerbOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiBeVerbFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingBeVerbIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">一般動詞</h3>
                    <p>動作や状態を表す動詞。主語や時制で形が変わる。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateVerbQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiVerbQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiVerbQuestionText" class="apple-question-text"></p>
                                <div id="aiVerbOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiVerbFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingVerbIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">形容詞</h3>
                    <p>名詞を修飾し、性質や状態を表す語。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateAdjectiveQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiAdjectiveQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiAdjectiveQuestionText" class="apple-question-text"></p>
                                <div id="aiAdjectiveOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiAdjectiveFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingAdjectiveIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">副詞</h3>
                    <p>動詞・形容詞・他の副詞を修飾する語。how, when, where, how muchなどを表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateAdverbQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiAdverbQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiAdverbQuestionText" class="apple-question-text"></p>
                                <div id="aiAdverbOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiAdverbFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingAdverbIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">前置詞</h3>
                    <p>名詞や代名詞の前に置き、場所・時間・方向などを示す語。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePrepositionQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPrepositionQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPrepositionQuestionText" class="apple-question-text"></p>
                                <div id="aiPrepositionOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPrepositionFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPrepositionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="apple-section-title">接続詞</h3>
                    <p>文や語をつなぐ語。and, but, or, becauseなど。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateConjunctionQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        <div id="aiConjunctionQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiConjunctionQuestionText" class="apple-question-text"></p>
                                <div id="aiConjunctionOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiConjunctionFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        <div id="loadingConjunctionIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 文型 -->
            <section id="sentencepattern" class="apple-card mb-8">
                <h2 class="apple-card-title">文型</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">第1文型（S+V）</h3>
                    <p class="apple-section-text">主語＋動詞だけで文が成立する。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern1Question" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern1QuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPattern1QuestionText" class="apple-question-text"></p>
                                <div id="aiPattern1OptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern1Feedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern1Indicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">第2文型（S+V+C）</h3>
                    <p class="apple-section-text">主語＋動詞＋補語。be動詞や「〜になる」動詞で使う。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern2Question" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern2QuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPattern2QuestionText" class="apple-question-text"></p>
                                <div id="aiPattern2OptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern2Feedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern2Indicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">第3文型（S+V+O）</h3>
                    <p class="apple-section-text">主語＋動詞＋目的語。多くの動詞がこの型。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern3Question" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern3QuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPattern3QuestionText" class="apple-question-text"></p>
                                <div id="aiPattern3OptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern3Feedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern3Indicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="apple-section-title">第4文型（S+V+O1+O2）</h3>
                    <p class="apple-section-text">主語＋動詞＋人＋物。「人に物を与える」など。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern4Question" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern4QuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPattern4QuestionText" class="apple-question-text"></p>
                                <div id="aiPattern4OptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern4Feedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern4Indicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 句 -->
            <section id="phrase" class="apple-card mb-8">
                <h2 class="apple-card-title">句</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">名詞句</h3>
                    <p class="apple-section-text">名詞の働きをする語の集まり。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateNounPhraseQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiNounPhraseQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiNounPhraseQuestionText" class="apple-question-text"></p>
                                <div id="aiNounPhraseOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiNounPhraseFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingNounPhraseIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 節 -->
            <section id="clause" class="apple-card mb-8">
                <h2 class="apple-card-title">節</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">関係代名詞</h3>
                    <p class="apple-section-text">名詞を修飾する節を作る代名詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateRelativePronounQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiRelativePronounQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiRelativePronounQuestionText" class="apple-question-text"></p>
                                <div id="aiRelativePronounOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiRelativePronounFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingRelativePronounIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 時制 -->
            <section id="tense" class="apple-card mb-8">
                <h2 class="apple-card-title">時制</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">現在形</h3>
                    <p class="apple-section-text">現在の習慣や事実を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePresentTenseQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPresentTenseQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiPresentTenseQuestionText" class="apple-question-text"></p>
                                <div id="aiPresentTenseOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPresentTenseFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPresentTenseIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 助動詞 -->
            <section id="modal" class="apple-card mb-8">
                <h2 class="apple-card-title">助動詞</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">can</h3>
                    <p class="apple-section-text">能力・可能性・許可を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateCanQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiCanQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiCanQuestionText" class="apple-question-text"></p>
                                <div id="aiCanOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiCanFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingCanIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 仮定法 -->
            <section id="subjunctive" class="apple-card mb-8">
                <h2 class="apple-card-title">仮定法</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">仮定法過去</h3>
                    <p class="apple-section-text">現在の事実に反する仮定を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubjunctivePastQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubjunctivePastQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiSubjunctivePastQuestionText" class="apple-question-text"></p>
                                <div id="aiSubjunctivePastOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubjunctivePastFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubjunctivePastIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 比較 -->
            <section id="comparison" class="apple-card mb-8">
                <h2 class="apple-card-title">比較</h2>
                <div class="prose max-w-none">
                    <h3 class="apple-section-title">比較級</h3>
                    <p class="apple-section-text">2つのものを比較する形。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="apple-ai-section">
                        <h4 class="apple-ai-title">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateComparativeQuestion" class="apple-ai-btn">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiComparativeQuestionContainer" class="hidden">
                            <div class="apple-question-card">
                                <p id="aiComparativeQuestionText" class="apple-question-text"></p>
                                <div id="aiComparativeOptionsContainer" class="apple-options-grid">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiComparativeFeedback" class="apple-feedback hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingComparativeIndicator" class="hidden">
                            <div class="apple-loading">
                                <div class="apple-spinner"></div>
                                <p class="apple-loading-text">問題を生成中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

    </main>
    
    <!-- フッター -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2025 Your English Learning Site. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // バックエンドAPI設定
        const API_BASE_URL = 'http://localhost:3000';
        
        // 名詞問題生成機能
        async function generateNounQuestion() {
            const generateBtn = document.getElementById('generateNounQuestion');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const aiQuestionContainer = document.getElementById('aiQuestionContainer');
            
            // ボタンを無効化し、ローディング表示
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'noun',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiQuestionContainer', 'aiQuestionText', 'aiOptionsContainer', 'aiFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                // UIを元に戻す
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 冠詞問題生成機能
        async function generateArticleQuestion() {
            const generateBtn = document.getElementById('generateArticleQuestion');
            const loadingIndicator = document.getElementById('loadingArticleIndicator');
            const aiQuestionContainer = document.getElementById('aiArticleQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'article',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiArticleQuestionContainer', 'aiArticleQuestionText', 'aiArticleOptionsContainer', 'aiArticleFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // be動詞問題生成機能
        async function generateBeVerbQuestion() {
            const generateBtn = document.getElementById('generateBeVerbQuestion');
            const loadingIndicator = document.getElementById('loadingBeVerbIndicator');
            const aiQuestionContainer = document.getElementById('aiBeVerbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'be_verb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiBeVerbQuestionContainer', 'aiBeVerbQuestionText', 'aiBeVerbOptionsContainer', 'aiBeVerbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 一般動詞問題生成機能
        async function generateVerbQuestion() {
            const generateBtn = document.getElementById('generateVerbQuestion');
            const loadingIndicator = document.getElementById('loadingVerbIndicator');
            const aiQuestionContainer = document.getElementById('aiVerbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'verb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiVerbQuestionContainer', 'aiVerbQuestionText', 'aiVerbOptionsContainer', 'aiVerbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 形容詞問題生成機能
        async function generateAdjectiveQuestion() {
            const generateBtn = document.getElementById('generateAdjectiveQuestion');
            const loadingIndicator = document.getElementById('loadingAdjectiveIndicator');
            const aiQuestionContainer = document.getElementById('aiAdjectiveQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'adjective',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiAdjectiveQuestionContainer', 'aiAdjectiveQuestionText', 'aiAdjectiveOptionsContainer', 'aiAdjectiveFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 副詞問題生成機能
        async function generateAdverbQuestion() {
            const generateBtn = document.getElementById('generateAdverbQuestion');
            const loadingIndicator = document.getElementById('loadingAdverbIndicator');
            const aiQuestionContainer = document.getElementById('aiAdverbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'adverb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiAdverbQuestionContainer', 'aiAdverbQuestionText', 'aiAdverbOptionsContainer', 'aiAdverbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 前置詞問題生成機能
        async function generatePrepositionQuestion() {
            const generateBtn = document.getElementById('generatePrepositionQuestion');
            const loadingIndicator = document.getElementById('loadingPrepositionIndicator');
            const aiQuestionContainer = document.getElementById('aiPrepositionQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'preposition',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiPrepositionQuestionContainer', 'aiPrepositionQuestionText', 'aiPrepositionOptionsContainer', 'aiPrepositionFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 接続詞問題生成機能
        async function generateConjunctionQuestion() {
            const generateBtn = document.getElementById('generateConjunctionQuestion');
            const loadingIndicator = document.getElementById('loadingConjunctionIndicator');
            const aiQuestionContainer = document.getElementById('aiConjunctionQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'conjunction',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiConjunctionQuestionContainer', 'aiConjunctionQuestionText', 'aiConjunctionOptionsContainer', 'aiConjunctionFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 句の問題生成機能
        async function generateNounPhraseQuestion() {
            await generateQuestionForTopic('noun_phrase', 'generateNounPhraseQuestion', 'loadingNounPhraseIndicator', 'aiNounPhraseQuestionContainer', 'aiNounPhraseQuestionText', 'aiNounPhraseOptionsContainer', 'aiNounPhraseFeedback');
        }

        // 節の問題生成機能
        async function generateRelativePronounQuestion() {
            await generateQuestionForTopic('relative_pronoun', 'generateRelativePronounQuestion', 'loadingRelativePronounIndicator', 'aiRelativePronounQuestionContainer', 'aiRelativePronounQuestionText', 'aiRelativePronounOptionsContainer', 'aiRelativePronounFeedback');
        }

        // 時制の問題生成機能
        async function generatePresentTenseQuestion() {
            await generateQuestionForTopic('present_tense', 'generatePresentTenseQuestion', 'loadingPresentTenseIndicator', 'aiPresentTenseQuestionContainer', 'aiPresentTenseQuestionText', 'aiPresentTenseOptionsContainer', 'aiPresentTenseFeedback');
        }

        // 助動詞の問題生成機能
        async function generateCanQuestion() {
            await generateQuestionForTopic('can', 'generateCanQuestion', 'loadingCanIndicator', 'aiCanQuestionContainer', 'aiCanQuestionText', 'aiCanOptionsContainer', 'aiCanFeedback');
        }

        // 仮定法の問題生成機能
        async function generateSubjunctivePastQuestion() {
            await generateQuestionForTopic('subjunctive_past', 'generateSubjunctivePastQuestion', 'loadingSubjunctivePastIndicator', 'aiSubjunctivePastQuestionContainer', 'aiSubjunctivePastQuestionText', 'aiSubjunctivePastOptionsContainer', 'aiSubjunctivePastFeedback');
        }

        // 比較の問題生成機能
        async function generateComparativeQuestion() {
            await generateQuestionForTopic('comparative', 'generateComparativeQuestion', 'loadingComparativeIndicator', 'aiComparativeQuestionContainer', 'aiComparativeQuestionText', 'aiComparativeOptionsContainer', 'aiComparativeFeedback');
        }

        // AI生成問題を表示（汎用関数）
        function displayAIQuestion(questionData, containerId, questionTextId, optionsContainerId, feedbackId) {
            const aiQuestionContainer = document.getElementById(containerId);
            const aiQuestionText = document.getElementById(questionTextId);
            const aiOptionsContainer = document.getElementById(optionsContainerId);
            const aiFeedback = document.getElementById(feedbackId);

            // 問題文を設定
            aiQuestionText.textContent = questionData.question;

            // 選択肢を生成
            aiOptionsContainer.innerHTML = '';
            questionData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'apple-option-btn';
                button.textContent = option.text;
                button.dataset.correct = option.correct.toString();
                button.dataset.index = index;
                aiOptionsContainer.appendChild(button);
            });

            // フィードバック要素を設定
            aiFeedback.dataset.explanation = questionData.explanation;
            aiFeedback.classList.add('hidden');
            aiFeedback.classList.remove('correct', 'incorrect');

            // コンテナを表示
            aiQuestionContainer.classList.remove('hidden');

            // イベントリスナーを設定
            setupAIQuestionEventListeners(containerId);
        }

        // AI問題のイベントリスナーを設定（汎用関数）
        function setupAIQuestionEventListeners(containerId) {
            const aiQuestionContainer = document.getElementById(containerId);
            const options = aiQuestionContainer.querySelectorAll('.apple-option-btn');
            const feedbackEl = aiQuestionContainer.querySelector('.apple-feedback');
            const explanation = feedbackEl.dataset.explanation;

            options.forEach(option => {
                option.addEventListener('click', function() {
                    if (aiQuestionContainer.dataset.answered === 'true') return;
                    aiQuestionContainer.dataset.answered = 'true';

                    const isCorrect = this.dataset.correct === 'true';

                    options.forEach(btn => {
                        btn.disabled = true;
                        btn.style.pointerEvents = 'none';
                    });

                    if (isCorrect) {
                        this.classList.add('correct');
                        feedbackEl.innerHTML = `<strong>正解！🎉</strong><br>${explanation}`;
                        feedbackEl.classList.remove('hidden');
                        feedbackEl.classList.add('correct');
                    } else {
                        this.classList.add('incorrect');
                        feedbackEl.innerHTML = `<strong>残念！不正解です。</strong><br>${explanation}`;
                        feedbackEl.classList.remove('hidden');
                        feedbackEl.classList.add('incorrect');
                        
                        options.forEach(btn => {
                            if (btn.dataset.correct === 'true') {
                                btn.classList.add('correct');
                            }
                        });
                    }
                });
            });
        }

        // サーバーの状態をチェック
        async function checkServerHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    console.log('Backend server is running');
                    return true;
                }
            } catch (error) {
                console.error('Backend server is not available:', error);
                return false;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // サーバーの状態をチェック
            checkServerHealth();

            // 既存の静的問題のイベントリスナー
            const questionItems = document.querySelectorAll('.question-item:not(#aiQuestionContainer .question-item)');

            questionItems.forEach(question => {
                const options = question.querySelectorAll('.option-btn');
                const feedbackEl = question.querySelector('.feedback');
                const explanation = feedbackEl.dataset.explanation;

                options.forEach(option => {
                    option.addEventListener('click', function() {
                        if (question.dataset.answered === 'true') return;
                        question.dataset.answered = 'true';

                        const isCorrect = this.dataset.correct === 'true';

                        options.forEach(btn => {
                            btn.disabled = true;
                            btn.style.pointerEvents = 'none';
                        });

                        if (isCorrect) {
                            this.classList.add('correct');
                            feedbackEl.innerHTML = `<strong>正解！🎉</strong><br>${explanation}`;
                            feedbackEl.classList.remove('hidden');
                            feedbackEl.classList.add('correct');
                        } else {
                            this.classList.add('incorrect');
                            feedbackEl.innerHTML = `<strong>残念！不正解です。</strong><br>${explanation}`;
                            feedbackEl.classList.remove('hidden');
                            feedbackEl.classList.add('incorrect');
                            
                            options.forEach(btn => {
                                if (btn.dataset.correct === 'true') {
                                    btn.classList.add('correct');
                                }
                            });
                        }
                    });
                });
            });

            // AI問題生成ボタンのイベントリスナー
            const generateNounBtn = document.getElementById('generateNounQuestion');
            if (generateNounBtn) {
                generateNounBtn.addEventListener('click', generateNounQuestion);
            }

            // 冠詞問題生成ボタンのイベントリスナー
            const generateArticleBtn = document.getElementById('generateArticleQuestion');
            if (generateArticleBtn) {
                generateArticleBtn.addEventListener('click', generateArticleQuestion);
            }

            // be動詞問題生成ボタンのイベントリスナー
            const generateBeVerbBtn = document.getElementById('generateBeVerbQuestion');
            if (generateBeVerbBtn) {
                generateBeVerbBtn.addEventListener('click', generateBeVerbQuestion);
            }

            // 一般動詞問題生成ボタンのイベントリスナー
            const generateVerbBtn = document.getElementById('generateVerbQuestion');
            if (generateVerbBtn) {
                generateVerbBtn.addEventListener('click', generateVerbQuestion);
            }

            // 形容詞問題生成ボタンのイベントリスナー
            const generateAdjectiveBtn = document.getElementById('generateAdjectiveQuestion');
            if (generateAdjectiveBtn) {
                generateAdjectiveBtn.addEventListener('click', generateAdjectiveQuestion);
            }

            // 副詞問題生成ボタンのイベントリスナー
            const generateAdverbBtn = document.getElementById('generateAdverbQuestion');
            if (generateAdverbBtn) {
                generateAdverbBtn.addEventListener('click', generateAdverbQuestion);
            }

            // 前置詞問題生成ボタンのイベントリスナー
            const generatePrepositionBtn = document.getElementById('generatePrepositionQuestion');
            if (generatePrepositionBtn) {
                generatePrepositionBtn.addEventListener('click', generatePrepositionQuestion);
            }

            // 接続詞問題生成ボタンのイベントリスナー
            const generateConjunctionBtn = document.getElementById('generateConjunctionQuestion');
            if (generateConjunctionBtn) {
                generateConjunctionBtn.addEventListener('click', generateConjunctionQuestion);
            }

            // 第1文型問題生成ボタンのイベントリスナー
            const generatePattern1Btn = document.getElementById('generatePattern1Question');
            if (generatePattern1Btn) {
                generatePattern1Btn.addEventListener('click', generatePattern1Question);
            }

            // 第2文型問題生成ボタンのイベントリスナー
            const generatePattern2Btn = document.getElementById('generatePattern2Question');
            if (generatePattern2Btn) {
                generatePattern2Btn.addEventListener('click', generatePattern2Question);
            }

            // 第3文型問題生成ボタンのイベントリスナー
            const generatePattern3Btn = document.getElementById('generatePattern3Question');
            if (generatePattern3Btn) {
                generatePattern3Btn.addEventListener('click', generatePattern3Question);
            }

            // 第4文型問題生成ボタンのイベントリスナー
            const generatePattern4Btn = document.getElementById('generatePattern4Question');
            if (generatePattern4Btn) {
                generatePattern4Btn.addEventListener('click', generatePattern4Question);
            }

            // 第5文型問題生成ボタンのイベントリスナー
            const generatePattern5Btn = document.getElementById('generatePattern5Question');
            if (generatePattern5Btn) {
                generatePattern5Btn.addEventListener('click', generatePattern5Question);
            }

            // 第3文型受動態問題生成ボタンのイベントリスナー
            const generatePassive3Btn = document.getElementById('generatePassive3Question');
            if (generatePassive3Btn) {
                generatePassive3Btn.addEventListener('click', generatePassive3Question);
            }

            // 第4文型受動態問題生成ボタンのイベントリスナー
            const generatePassive4Btn = document.getElementById('generatePassive4Question');
            if (generatePassive4Btn) {
                generatePassive4Btn.addEventListener('click', generatePassive4Question);
            }

            // 第5文型受動態問題生成ボタンのイベントリスナー
            const generatePassive5Btn = document.getElementById('generatePassive5Question');
            if (generatePassive5Btn) {
                generatePassive5Btn.addEventListener('click', generatePassive5Question);
            }

            // 句の問題生成ボタンのイベントリスナー
            const generateNounPhraseBtn = document.getElementById('generateNounPhraseQuestion');
            if (generateNounPhraseBtn) {
                generateNounPhraseBtn.addEventListener('click', generateNounPhraseQuestion);
            }

            // 節の問題生成ボタンのイベントリスナー
            const generateRelativePronounBtn = document.getElementById('generateRelativePronounQuestion');
            if (generateRelativePronounBtn) {
                generateRelativePronounBtn.addEventListener('click', generateRelativePronounQuestion);
            }

            // 時制の問題生成ボタンのイベントリスナー
            const generatePresentTenseBtn = document.getElementById('generatePresentTenseQuestion');
            if (generatePresentTenseBtn) {
                generatePresentTenseBtn.addEventListener('click', generatePresentTenseQuestion);
            }

            // 助動詞の問題生成ボタンのイベントリスナー
            const generateCanBtn = document.getElementById('generateCanQuestion');
            if (generateCanBtn) {
                generateCanBtn.addEventListener('click', generateCanQuestion);
            }

            // 仮定法の問題生成ボタンのイベントリスナー
            const generateSubjunctivePastBtn = document.getElementById('generateSubjunctivePastQuestion');
            if (generateSubjunctivePastBtn) {
                generateSubjunctivePastBtn.addEventListener('click', generateSubjunctivePastQuestion);
            }

            // 比較の問題生成ボタンのイベントリスナー
            const generateComparativeBtn = document.getElementById('generateComparativeQuestion');
            if (generateComparativeBtn) {
                generateComparativeBtn.addEventListener('click', generateComparativeQuestion);
            }
        });

        // 汎用AI問題生成関数
        async function generateQuestionForTopic(topic, generateBtnId, loadingIndicatorId, containerId, questionTextId, optionsContainerId, feedbackId) {
            const generateBtn = document.getElementById(generateBtnId);
            const loadingIndicator = document.getElementById(loadingIndicatorId);
            const aiQuestionContainer = document.getElementById(containerId);

            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: topic,
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, containerId, questionTextId, optionsContainerId, feedbackId);

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 文型の問題生成機能
        async function generatePattern1Question() {
            await generateQuestionForTopic('pattern1', 'generatePattern1Question', 'loadingPattern1Indicator', 'aiPattern1QuestionContainer', 'aiPattern1QuestionText', 'aiPattern1OptionsContainer', 'aiPattern1Feedback');
        }

        async function generatePattern2Question() {
            await generateQuestionForTopic('pattern2', 'generatePattern2Question', 'loadingPattern2Indicator', 'aiPattern2QuestionContainer', 'aiPattern2QuestionText', 'aiPattern2OptionsContainer', 'aiPattern2Feedback');
        }

        async function generatePattern3Question() {
            await generateQuestionForTopic('pattern3', 'generatePattern3Question', 'loadingPattern3Indicator', 'aiPattern3QuestionContainer', 'aiPattern3QuestionText', 'aiPattern3OptionsContainer', 'aiPattern3Feedback');
        }

        async function generatePattern4Question() {
            await generateQuestionForTopic('pattern4', 'generatePattern4Question', 'loadingPattern4Indicator', 'aiPattern4QuestionContainer', 'aiPattern4QuestionText', 'aiPattern4OptionsContainer', 'aiPattern4Feedback');
        }

        async function generatePattern5Question() {
            await generateQuestionForTopic('pattern5', 'generatePattern5Question', 'loadingPattern5Indicator', 'aiPattern5QuestionContainer', 'aiPattern5QuestionText', 'aiPattern5OptionsContainer', 'aiPattern5Feedback');
        }

        async function generatePassive3Question() {
            await generateQuestionForTopic('passive3', 'generatePassive3Question', 'loadingPassive3Indicator', 'aiPassive3QuestionContainer', 'aiPassive3QuestionText', 'aiPassive3OptionsContainer', 'aiPassive3Feedback');
        }

        async function generatePassive4Question() {
            await generateQuestionForTopic('passive4', 'generatePassive4Question', 'loadingPassive4Indicator', 'aiPassive4QuestionContainer', 'aiPassive4QuestionText', 'aiPassive4OptionsContainer', 'aiPassive4Feedback');
        }

        async function generatePassive5Question() {
            await generateQuestionForTopic('passive5', 'generatePassive5Question', 'loadingPassive5Indicator', 'aiPassive5QuestionContainer', 'aiPassive5QuestionText', 'aiPassive5OptionsContainer', 'aiPassive5Feedback');
        }
    </script>

</body>
</html>