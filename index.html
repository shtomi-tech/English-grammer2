<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語学習サイト (プロトタイプ)</title>
    
    <!-- Tailwind CSSをCDN経由で読み込みます -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fontsから見やすいフォントを読み込みます -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* 基本のフォント設定 */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* フィードバック表示のアニメーション */
        .feedback {
            transition: all 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- ヘッダー -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-2xl md:text-3xl font-bold">English Learning Hub</h1>
            <p class="mt-1 text-sm">英文法の基礎から学ぼう</p>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main class="container mx-auto px-6 py-8">
        
        <div class="max-w-4xl mx-auto">
            <!-- サイト紹介 -->
            <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-3">このサイトについて</h2>
                <p class="text-gray-600">
                    このウェブサイトは、英語の基礎となる英文法を学ぶためのリソースです。<br>
                    各単元の解説を読み、練習問題に挑戦して理解を深めていきましょう。<br>
                    まずは下の「品詞」から始めてみてください。
                </p>
            </div>

            <!-- ナビゲーションボタン -->
            <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-3">文法セクションへ移動</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <button onclick="location.href='#partsofspeech'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">品詞</button>
                    <button onclick="location.href='#sentencepattern'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">文型</button>
                    <button onclick="location.href='#phrase'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">句</button>
                    <button onclick="location.href='#clause'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">節</button>
                    <button onclick="location.href='#tense'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">時制</button>
                    <button onclick="location.href='#modal'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">助動詞</button>
                    <button onclick="location.href='#subjunctive'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">仮定法</button>
                    <button onclick="location.href='#comparison'" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">比較</button>
                </div>
            </div>

            <!-- 品詞 -->
            <section id="partsofspeech" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">品詞</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">名詞</h3>
                    <p>人・物・場所・考えなどを表す語。可算名詞と不可算名詞がある。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateNounQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiQuestionText" class="font-bold mb-3"></p>
                                <div id="aiOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">冠詞</h3>
                    <p>名詞の前に付けて特定・不特定を示す語。a/an（不特定）、the（特定）。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateArticleQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiArticleQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiArticleQuestionText" class="font-bold mb-3"></p>
                                <div id="aiArticleOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiArticleFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingArticleIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">be動詞</h3>
                    <p>主語の状態や存在を表す動詞。am/is/areがある。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateBeVerbQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiBeVerbQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiBeVerbQuestionText" class="font-bold mb-3"></p>
                                <div id="aiBeVerbOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiBeVerbFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingBeVerbIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">一般動詞</h3>
                    <p>動作や状態を表す動詞。主語や時制で形が変わる。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateVerbQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiVerbQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiVerbQuestionText" class="font-bold mb-3"></p>
                                <div id="aiVerbOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiVerbFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingVerbIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">形容詞</h3>
                    <p>名詞を修飾し、性質や状態を表す語。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateAdjectiveQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiAdjectiveQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiAdjectiveQuestionText" class="font-bold mb-3"></p>
                                <div id="aiAdjectiveOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiAdjectiveFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingAdjectiveIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">副詞</h3>
                    <p>動詞・形容詞・他の副詞を修飾する語。how, when, where, how muchなどを表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateAdverbQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiAdverbQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiAdverbQuestionText" class="font-bold mb-3"></p>
                                <div id="aiAdverbOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiAdverbFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingAdverbIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">前置詞</h3>
                    <p>名詞や代名詞の前に置き、場所・時間・方向などを示す語。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePrepositionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPrepositionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPrepositionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPrepositionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPrepositionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPrepositionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">接続詞</h3>
                    <p>文や語をつなぐ語。and, but, or, becauseなど。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateConjunctionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiConjunctionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiConjunctionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiConjunctionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiConjunctionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingConjunctionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 文型 -->
            <section id="sentencepattern" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">文型</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">第1文型（S+V）</h3>
                    <p>主語＋動詞だけで文が成立する。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern1Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern1QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPattern1QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPattern1OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern1Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern1Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第2文型（S+V+C）</h3>
                    <p>主語＋動詞＋補語。be動詞や「〜になる」動詞で使う。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern2Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern2QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPattern2QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPattern2OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern2Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern2Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第3文型（S+V+O）</h3>
                    <p>主語＋動詞＋目的語。多くの動詞がこの型。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern3Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern3QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPattern3QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPattern3OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern3Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern3Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第4文型（S+V+O1+O2）</h3>
                    <p>主語＋動詞＋人＋物。「人に物を与える」など。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern4Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern4QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPattern4QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPattern4OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern4Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern4Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第5文型（S+V+O+C）</h3>
                    <p>主語＋動詞＋目的語＋補語。目的語がどうなるかを説明。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePattern5Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPattern5QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPattern5QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPattern5OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPattern5Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPattern5Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第3文型の受動態</h3>
                    <p>目的語が主語になる受け身の文。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePassive3Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPassive3QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPassive3QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPassive3OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPassive3Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPassive3Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第4文型の受動態</h3>
                    <p>「人」または「物」が主語になる受け身の文。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePassive4Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPassive4QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPassive4QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPassive4OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPassive4Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPassive4Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">第5文型の受動態</h3>
                    <p>目的語＋補語の受け身。補語はそのまま残る。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePassive5Question" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPassive5QuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPassive5QuestionText" class="font-bold mb-3"></p>
                                <div id="aiPassive5OptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPassive5Feedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPassive5Indicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 句 -->
            <section id="phrase" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">句</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">動名詞</h3>
                    <p>動詞のing形で名詞の働きをする。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateGerundQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiGerundQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiGerundQuestionText" class="font-bold mb-3"></p>
                                <div id="aiGerundOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiGerundFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingGerundIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">不定詞</h3>
                    <p>to＋動詞の原形。名詞・形容詞・副詞の働き。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateInfinitiveQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiInfinitiveQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiInfinitiveQuestionText" class="font-bold mb-3"></p>
                                <div id="aiInfinitiveOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiInfinitiveFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingInfinitiveIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">分詞</h3>
                    <p>現在分詞（〜している）・過去分詞（〜された）。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateParticipleQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiParticipleQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiParticipleQuestionText" class="font-bold mb-3"></p>
                                <div id="aiParticipleOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiParticipleFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingParticipleIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">分詞構文</h3>
                    <p>分詞を使って副詞節を簡略化した表現。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateParticipleConstructionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiParticipleConstructionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiParticipleConstructionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiParticipleConstructionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiParticipleConstructionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingParticipleConstructionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 節 -->
            <section id="clause" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">節</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">関係代名詞</h3>
                    <p>名詞を修飾する節を作るwho, which, thatなど。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateRelativePronounQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiRelativePronounQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiRelativePronounQuestionText" class="font-bold mb-3"></p>
                                <div id="aiRelativePronounOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiRelativePronounFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingRelativePronounIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">関係副詞</h3>
                    <p>when, where, whyなどで節を作り、名詞を修飾。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateRelativeAdverbQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiRelativeAdverbQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiRelativeAdverbQuestionText" class="font-bold mb-3"></p>
                                <div id="aiRelativeAdverbOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiRelativeAdverbFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingRelativeAdverbIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">従属接続詞</h3>
                    <p>because, if, when, althoughなどで節を導く。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubordinateConjunctionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubordinateConjunctionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSubordinateConjunctionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSubordinateConjunctionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubordinateConjunctionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubordinateConjunctionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">間接疑問文</h3>
                    <p>疑問詞＋主語＋動詞の語順になる間接的な疑問。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateIndirectQuestionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiIndirectQuestionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiIndirectQuestionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiIndirectQuestionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiIndirectQuestionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingIndirectQuestionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 時制 -->
            <section id="tense" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">時制</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">現在形</h3>
                    <p>習慣・事実・状態を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePresentTenseQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPresentTenseQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPresentTenseQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPresentTenseOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPresentTenseFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPresentTenseIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">過去形</h3>
                    <p>過去の出来事を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePastTenseQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPastTenseQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPastTenseQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPastTenseOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPastTenseFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPastTenseIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">進行形</h3>
                    <p>〜している最中を表す。be動詞＋動詞ing。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateProgressiveTenseQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiProgressiveTenseQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiProgressiveTenseQuestionText" class="font-bold mb-3"></p>
                                <div id="aiProgressiveTenseOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiProgressiveTenseFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingProgressiveTenseIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">現在完了</h3>
                    <p>「〜したことがある」「ずっと〜している」「〜したところだ」など。have/has＋過去分詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePresentPerfectQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPresentPerfectQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPresentPerfectQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPresentPerfectOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPresentPerfectFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPresentPerfectIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">過去完了</h3>
                    <p>過去のある時点より前の出来事。had＋過去分詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePastPerfectQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPastPerfectQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPastPerfectQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPastPerfectOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPastPerfectFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPastPerfectIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">未来完了形</h3>
                    <p>未来のある時点までに完了していること。will have＋過去分詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateFuturePerfectQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiFuturePerfectQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiFuturePerfectQuestionText" class="font-bold mb-3"></p>
                                <div id="aiFuturePerfectOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiFuturePerfectFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingFuturePerfectIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 助動詞 -->
            <section id="modal" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">助動詞</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">can</h3>
                    <p>可能・許可・能力を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateCanQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiCanQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiCanQuestionText" class="font-bold mb-3"></p>
                                <div id="aiCanOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiCanFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingCanIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">will</h3>
                    <p>未来・意志・推量を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateWillQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiWillQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiWillQuestionText" class="font-bold mb-3"></p>
                                <div id="aiWillOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiWillFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingWillIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">may</h3>
                    <p>許可・推量を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateMayQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiMayQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiMayQuestionText" class="font-bold mb-3"></p>
                                <div id="aiMayOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiMayFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingMayIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">must</h3>
                    <p>義務・強い推量を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateMustQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiMustQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiMustQuestionText" class="font-bold mb-3"></p>
                                <div id="aiMustOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiMustFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingMustIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">should</h3>
                    <p>助言・当然を表す。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateShouldQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiShouldQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiShouldQuestionText" class="font-bold mb-3"></p>
                                <div id="aiShouldOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiShouldFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingShouldIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 仮定法 -->
            <section id="subjunctive" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">仮定法</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">仮定法過去</h3>
                    <p>現在の事実と反対の仮定。If＋過去形。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubjunctivePastQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubjunctivePastQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSubjunctivePastQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSubjunctivePastOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubjunctivePastFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubjunctivePastIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">仮定法過去完了</h3>
                    <p>過去の事実と反対の仮定。If＋had＋過去分詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubjunctivePastPerfectQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubjunctivePastPerfectQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSubjunctivePastPerfectQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSubjunctivePastPerfectOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubjunctivePastPerfectFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubjunctivePastPerfectIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">仮定法未来</h3>
                    <p>未来の仮定。If＋should/were to＋動詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubjunctiveFutureQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubjunctiveFutureQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSubjunctiveFutureQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSubjunctiveFutureOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubjunctiveFutureFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubjunctiveFutureIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">仮定法倒置</h3>
                    <p>ifを省略し、助動詞を前に出す倒置表現。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSubjunctiveInversionQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSubjunctiveInversionQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSubjunctiveInversionQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSubjunctiveInversionOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSubjunctiveInversionFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSubjunctiveInversionIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 比較 -->
            <section id="comparison" class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mb-4">比較</h2>
                <div class="prose max-w-none">
                    <h3 class="text-xl font-bold mt-4">比較級</h3>
                    <p>2つを比べて「より〜」を表す。形容詞＋er/more＋形容詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateComparativeQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiComparativeQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiComparativeQuestionText" class="font-bold mb-3"></p>
                                <div id="aiComparativeOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiComparativeFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingComparativeIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">最上級</h3>
                    <p>3つ以上の中で「最も〜」を表す。the＋形容詞＋est/the most＋形容詞。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generateSuperlativeQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiSuperlativeQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiSuperlativeQuestionText" class="font-bold mb-3"></p>
                                <div id="aiSuperlativeOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiSuperlativeFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingSuperlativeIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-bold mt-6">原級</h3>
                    <p>同等比較。「as〜as」を使う。</p>
                    
                    <!-- AI生成問題セクション -->
                    <div class="ai-question-section mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                        <h4 class="text-lg font-bold text-blue-800 mb-3">AI生成問題</h4>
                        <div class="mb-4">
                            <button id="generatePositiveQuestion" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                新しい問題を生成
                            </button>
                        </div>
                        
                        <div id="aiPositiveQuestionContainer" class="hidden">
                            <div class="question-item mb-6 p-4 border border-gray-200 rounded-lg bg-white">
                                <p id="aiPositiveQuestionText" class="font-bold mb-3"></p>
                                <div id="aiPositiveOptionsContainer" class="options-container grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <!-- AI生成の選択肢がここに表示されます -->
                                </div>
                                <div id="aiPositiveFeedback" class="feedback mt-3 p-3 rounded-lg hidden"></div>
                            </div>
                        </div>
                        
                        <div id="loadingPositiveIndicator" class="hidden text-center py-4">
                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <p class="mt-2 text-gray-600">問題を生成中...</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

    </main>
    
    <!-- フッター -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2025 Your English Learning Site. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // バックエンドAPI設定
        const API_BASE_URL = 'http://localhost:3000';
        
        // 名詞問題生成機能
        async function generateNounQuestion() {
            const generateBtn = document.getElementById('generateNounQuestion');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const aiQuestionContainer = document.getElementById('aiQuestionContainer');
            
            // ボタンを無効化し、ローディング表示
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'noun',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiQuestionContainer', 'aiQuestionText', 'aiOptionsContainer', 'aiFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                // UIを元に戻す
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 冠詞問題生成機能
        async function generateArticleQuestion() {
            const generateBtn = document.getElementById('generateArticleQuestion');
            const loadingIndicator = document.getElementById('loadingArticleIndicator');
            const aiQuestionContainer = document.getElementById('aiArticleQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'article',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiArticleQuestionContainer', 'aiArticleQuestionText', 'aiArticleOptionsContainer', 'aiArticleFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // be動詞問題生成機能
        async function generateBeVerbQuestion() {
            const generateBtn = document.getElementById('generateBeVerbQuestion');
            const loadingIndicator = document.getElementById('loadingBeVerbIndicator');
            const aiQuestionContainer = document.getElementById('aiBeVerbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'be_verb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiBeVerbQuestionContainer', 'aiBeVerbQuestionText', 'aiBeVerbOptionsContainer', 'aiBeVerbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 一般動詞問題生成機能
        async function generateVerbQuestion() {
            const generateBtn = document.getElementById('generateVerbQuestion');
            const loadingIndicator = document.getElementById('loadingVerbIndicator');
            const aiQuestionContainer = document.getElementById('aiVerbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'verb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiVerbQuestionContainer', 'aiVerbQuestionText', 'aiVerbOptionsContainer', 'aiVerbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 形容詞問題生成機能
        async function generateAdjectiveQuestion() {
            const generateBtn = document.getElementById('generateAdjectiveQuestion');
            const loadingIndicator = document.getElementById('loadingAdjectiveIndicator');
            const aiQuestionContainer = document.getElementById('aiAdjectiveQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'adjective',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiAdjectiveQuestionContainer', 'aiAdjectiveQuestionText', 'aiAdjectiveOptionsContainer', 'aiAdjectiveFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 副詞問題生成機能
        async function generateAdverbQuestion() {
            const generateBtn = document.getElementById('generateAdverbQuestion');
            const loadingIndicator = document.getElementById('loadingAdverbIndicator');
            const aiQuestionContainer = document.getElementById('aiAdverbQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'adverb',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiAdverbQuestionContainer', 'aiAdverbQuestionText', 'aiAdverbOptionsContainer', 'aiAdverbFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 前置詞問題生成機能
        async function generatePrepositionQuestion() {
            const generateBtn = document.getElementById('generatePrepositionQuestion');
            const loadingIndicator = document.getElementById('loadingPrepositionIndicator');
            const aiQuestionContainer = document.getElementById('aiPrepositionQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'preposition',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiPrepositionQuestionContainer', 'aiPrepositionQuestionText', 'aiPrepositionOptionsContainer', 'aiPrepositionFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 接続詞問題生成機能
        async function generateConjunctionQuestion() {
            const generateBtn = document.getElementById('generateConjunctionQuestion');
            const loadingIndicator = document.getElementById('loadingConjunctionIndicator');
            const aiQuestionContainer = document.getElementById('aiConjunctionQuestionContainer');
            
            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: 'conjunction',
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, 'aiConjunctionQuestionContainer', 'aiConjunctionQuestionText', 'aiConjunctionOptionsContainer', 'aiConjunctionFeedback');

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 句の問題生成機能
        async function generateGerundQuestion() {
            await generateQuestionForTopic('gerund', 'generateGerundQuestion', 'loadingGerundIndicator', 'aiGerundQuestionContainer', 'aiGerundQuestionText', 'aiGerundOptionsContainer', 'aiGerundFeedback');
        }

        async function generateInfinitiveQuestion() {
            await generateQuestionForTopic('infinitive', 'generateInfinitiveQuestion', 'loadingInfinitiveIndicator', 'aiInfinitiveQuestionContainer', 'aiInfinitiveQuestionText', 'aiInfinitiveOptionsContainer', 'aiInfinitiveFeedback');
        }

        async function generateParticipleQuestion() {
            await generateQuestionForTopic('participle', 'generateParticipleQuestion', 'loadingParticipleIndicator', 'aiParticipleQuestionContainer', 'aiParticipleQuestionText', 'aiParticipleOptionsContainer', 'aiParticipleFeedback');
        }

        async function generateParticipleConstructionQuestion() {
            await generateQuestionForTopic('participle_construction', 'generateParticipleConstructionQuestion', 'loadingParticipleConstructionIndicator', 'aiParticipleConstructionQuestionContainer', 'aiParticipleConstructionQuestionText', 'aiParticipleConstructionOptionsContainer', 'aiParticipleConstructionFeedback');
        }

        // 節の問題生成機能
        async function generateRelativePronounQuestion() {
            await generateQuestionForTopic('relative_pronoun', 'generateRelativePronounQuestion', 'loadingRelativePronounIndicator', 'aiRelativePronounQuestionContainer', 'aiRelativePronounQuestionText', 'aiRelativePronounOptionsContainer', 'aiRelativePronounFeedback');
        }

        async function generateRelativeAdverbQuestion() {
            await generateQuestionForTopic('relative_adverb', 'generateRelativeAdverbQuestion', 'loadingRelativeAdverbIndicator', 'aiRelativeAdverbQuestionContainer', 'aiRelativeAdverbQuestionText', 'aiRelativeAdverbOptionsContainer', 'aiRelativeAdverbFeedback');
        }

        async function generateSubordinateConjunctionQuestion() {
            await generateQuestionForTopic('subordinate_conjunction', 'generateSubordinateConjunctionQuestion', 'loadingSubordinateConjunctionIndicator', 'aiSubordinateConjunctionQuestionContainer', 'aiSubordinateConjunctionQuestionText', 'aiSubordinateConjunctionOptionsContainer', 'aiSubordinateConjunctionFeedback');
        }

        async function generateIndirectQuestionQuestion() {
            await generateQuestionForTopic('indirect_question', 'generateIndirectQuestionQuestion', 'loadingIndirectQuestionIndicator', 'aiIndirectQuestionQuestionContainer', 'aiIndirectQuestionQuestionText', 'aiIndirectQuestionOptionsContainer', 'aiIndirectQuestionFeedback');
        }

        // 時制の問題生成機能
        async function generatePresentTenseQuestion() {
            await generateQuestionForTopic('present_tense', 'generatePresentTenseQuestion', 'loadingPresentTenseIndicator', 'aiPresentTenseQuestionContainer', 'aiPresentTenseQuestionText', 'aiPresentTenseOptionsContainer', 'aiPresentTenseFeedback');
        }

        async function generatePastTenseQuestion() {
            await generateQuestionForTopic('past_tense', 'generatePastTenseQuestion', 'loadingPastTenseIndicator', 'aiPastTenseQuestionContainer', 'aiPastTenseQuestionText', 'aiPastTenseOptionsContainer', 'aiPastTenseFeedback');
        }

        async function generateProgressiveTenseQuestion() {
            await generateQuestionForTopic('progressive_tense', 'generateProgressiveTenseQuestion', 'loadingProgressiveTenseIndicator', 'aiProgressiveTenseQuestionContainer', 'aiProgressiveTenseQuestionText', 'aiProgressiveTenseOptionsContainer', 'aiProgressiveTenseFeedback');
        }

        async function generatePresentPerfectQuestion() {
            await generateQuestionForTopic('present_perfect', 'generatePresentPerfectQuestion', 'loadingPresentPerfectIndicator', 'aiPresentPerfectQuestionContainer', 'aiPresentPerfectQuestionText', 'aiPresentPerfectOptionsContainer', 'aiPresentPerfectFeedback');
        }

        async function generatePastPerfectQuestion() {
            await generateQuestionForTopic('past_perfect', 'generatePastPerfectQuestion', 'loadingPastPerfectIndicator', 'aiPastPerfectQuestionContainer', 'aiPastPerfectQuestionText', 'aiPastPerfectOptionsContainer', 'aiPastPerfectFeedback');
        }

        async function generateFuturePerfectQuestion() {
            await generateQuestionForTopic('future_perfect', 'generateFuturePerfectQuestion', 'loadingFuturePerfectIndicator', 'aiFuturePerfectQuestionContainer', 'aiFuturePerfectQuestionText', 'aiFuturePerfectOptionsContainer', 'aiFuturePerfectFeedback');
        }

        // 助動詞の問題生成機能
        async function generateCanQuestion() {
            await generateQuestionForTopic('can', 'generateCanQuestion', 'loadingCanIndicator', 'aiCanQuestionContainer', 'aiCanQuestionText', 'aiCanOptionsContainer', 'aiCanFeedback');
        }

        async function generateWillQuestion() {
            await generateQuestionForTopic('will', 'generateWillQuestion', 'loadingWillIndicator', 'aiWillQuestionContainer', 'aiWillQuestionText', 'aiWillOptionsContainer', 'aiWillFeedback');
        }

        async function generateMayQuestion() {
            await generateQuestionForTopic('may', 'generateMayQuestion', 'loadingMayIndicator', 'aiMayQuestionContainer', 'aiMayQuestionText', 'aiMayOptionsContainer', 'aiMayFeedback');
        }

        async function generateMustQuestion() {
            await generateQuestionForTopic('must', 'generateMustQuestion', 'loadingMustIndicator', 'aiMustQuestionContainer', 'aiMustQuestionText', 'aiMustOptionsContainer', 'aiMustFeedback');
        }

        async function generateShouldQuestion() {
            await generateQuestionForTopic('should', 'generateShouldQuestion', 'loadingShouldIndicator', 'aiShouldQuestionContainer', 'aiShouldQuestionText', 'aiShouldOptionsContainer', 'aiShouldFeedback');
        }

        // 仮定法の問題生成機能
        async function generateSubjunctivePastQuestion() {
            await generateQuestionForTopic('subjunctive_past', 'generateSubjunctivePastQuestion', 'loadingSubjunctivePastIndicator', 'aiSubjunctivePastQuestionContainer', 'aiSubjunctivePastQuestionText', 'aiSubjunctivePastOptionsContainer', 'aiSubjunctivePastFeedback');
        }

        async function generateSubjunctivePastPerfectQuestion() {
            await generateQuestionForTopic('subjunctive_past_perfect', 'generateSubjunctivePastPerfectQuestion', 'loadingSubjunctivePastPerfectIndicator', 'aiSubjunctivePastPerfectQuestionContainer', 'aiSubjunctivePastPerfectQuestionText', 'aiSubjunctivePastPerfectOptionsContainer', 'aiSubjunctivePastPerfectFeedback');
        }

        async function generateSubjunctiveFutureQuestion() {
            await generateQuestionForTopic('subjunctive_future', 'generateSubjunctiveFutureQuestion', 'loadingSubjunctiveFutureIndicator', 'aiSubjunctiveFutureQuestionContainer', 'aiSubjunctiveFutureQuestionText', 'aiSubjunctiveFutureOptionsContainer', 'aiSubjunctiveFutureFeedback');
        }

        async function generateSubjunctiveInversionQuestion() {
            await generateQuestionForTopic('subjunctive_inversion', 'generateSubjunctiveInversionQuestion', 'loadingSubjunctiveInversionIndicator', 'aiSubjunctiveInversionQuestionContainer', 'aiSubjunctiveInversionQuestionText', 'aiSubjunctiveInversionOptionsContainer', 'aiSubjunctiveInversionFeedback');
        }

        // 比較の問題生成機能
        async function generateComparativeQuestion() {
            await generateQuestionForTopic('comparative', 'generateComparativeQuestion', 'loadingComparativeIndicator', 'aiComparativeQuestionContainer', 'aiComparativeQuestionText', 'aiComparativeOptionsContainer', 'aiComparativeFeedback');
        }

        async function generateSuperlativeQuestion() {
            await generateQuestionForTopic('superlative', 'generateSuperlativeQuestion', 'loadingSuperlativeIndicator', 'aiSuperlativeQuestionContainer', 'aiSuperlativeQuestionText', 'aiSuperlativeOptionsContainer', 'aiSuperlativeFeedback');
        }

        async function generatePositiveQuestion() {
            await generateQuestionForTopic('positive', 'generatePositiveQuestion', 'loadingPositiveIndicator', 'aiPositiveQuestionContainer', 'aiPositiveQuestionText', 'aiPositiveOptionsContainer', 'aiPositiveFeedback');
        }

        // AI生成問題を表示（汎用関数）
        function displayAIQuestion(questionData, containerId, questionTextId, optionsContainerId, feedbackId) {
            const aiQuestionContainer = document.getElementById(containerId);
            const aiQuestionText = document.getElementById(questionTextId);
            const aiOptionsContainer = document.getElementById(optionsContainerId);
            const aiFeedback = document.getElementById(feedbackId);

            // 問題文を設定
            aiQuestionText.textContent = questionData.question;

            // 選択肢を生成
            aiOptionsContainer.innerHTML = '';
            questionData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn p-3 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors';
                button.textContent = option.text;
                button.dataset.correct = option.correct.toString();
                button.dataset.index = index;
                aiOptionsContainer.appendChild(button);
            });

            // フィードバック要素を設定
            aiFeedback.dataset.explanation = questionData.explanation;
            aiFeedback.classList.add('hidden');
            aiFeedback.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');

            // コンテナを表示
            aiQuestionContainer.classList.remove('hidden');

            // イベントリスナーを設定
            setupAIQuestionEventListeners(containerId);
        }

        // AI問題のイベントリスナーを設定（汎用関数）
        function setupAIQuestionEventListeners(containerId) {
            const aiQuestionContainer = document.getElementById(containerId);
            const options = aiQuestionContainer.querySelectorAll('.option-btn');
            const feedbackEl = aiQuestionContainer.querySelector('.feedback');
            const explanation = feedbackEl.dataset.explanation;

            options.forEach(option => {
                option.addEventListener('click', function() {
                    if (aiQuestionContainer.dataset.answered === 'true') return;
                    aiQuestionContainer.dataset.answered = 'true';

                    const isCorrect = this.dataset.correct === 'true';

                    options.forEach(btn => {
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    });

                    if (isCorrect) {
                        this.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        this.classList.add('bg-green-500', 'text-white', 'ring-2', 'ring-green-600');
                        feedbackEl.innerHTML = `<strong class="font-bold">正解！🎉</strong><br>${explanation}`;
                        feedbackEl.classList.remove('hidden');
                        feedbackEl.classList.add('bg-green-100', 'text-green-800');
                    } else {
                        this.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        this.classList.add('bg-red-500', 'text-white', 'ring-2', 'ring-red-600');
                        feedbackEl.innerHTML = `<strong class="font-bold">残念！不正解です。</strong><br>${explanation}`;
                        feedbackEl.classList.remove('hidden');
                        feedbackEl.classList.add('bg-red-100', 'text-red-800');
                        
                        options.forEach(btn => {
                            if (btn.dataset.correct === 'true') {
                                btn.classList.remove('bg-gray-200', 'opacity-50');
                                btn.classList.add('bg-green-500', 'text-white', 'ring-2', 'ring-green-600');
                            }
                        });
                    }
                });
            });
        }

        // サーバーの状態をチェック
        async function checkServerHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    console.log('Backend server is running');
                    return true;
                }
            } catch (error) {
                console.error('Backend server is not available:', error);
                return false;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // サーバーの状態をチェック
            checkServerHealth();

            // 既存の静的問題のイベントリスナー
            const questionItems = document.querySelectorAll('.question-item:not(#aiQuestionContainer .question-item)');

            questionItems.forEach(question => {
                const options = question.querySelectorAll('.option-btn');
                const feedbackEl = question.querySelector('.feedback');
                const explanation = feedbackEl.dataset.explanation;

                options.forEach(option => {
                    option.addEventListener('click', function() {
                        if (question.dataset.answered === 'true') return;
                        question.dataset.answered = 'true';

                        const isCorrect = this.dataset.correct === 'true';

                        options.forEach(btn => {
                            btn.disabled = true;
                            btn.classList.add('opacity-50', 'cursor-not-allowed');
                        });

                        if (isCorrect) {
                            this.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                            this.classList.add('bg-green-500', 'text-white', 'ring-2', 'ring-green-600');
                            feedbackEl.innerHTML = `<strong class="font-bold">正解！🎉</strong><br>${explanation}`;
                            feedbackEl.classList.remove('hidden');
                            feedbackEl.classList.add('bg-green-100', 'text-green-800');
                        } else {
                            this.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                            this.classList.add('bg-red-500', 'text-white', 'ring-2', 'ring-red-600');
                            feedbackEl.innerHTML = `<strong class="font-bold">残念！不正解です。</strong><br>${explanation}`;
                            feedbackEl.classList.remove('hidden');
                            feedbackEl.classList.add('bg-red-100', 'text-red-800');
                            
                            options.forEach(btn => {
                                if (btn.dataset.correct === 'true') {
                                    btn.classList.remove('bg-gray-200', 'opacity-50');
                                    btn.classList.add('bg-green-500', 'text-white', 'ring-2', 'ring-green-600');
                                }
                            });
                        }
                    });
                });
            });

            // AI問題生成ボタンのイベントリスナー
            const generateNounBtn = document.getElementById('generateNounQuestion');
            if (generateNounBtn) {
                generateNounBtn.addEventListener('click', generateNounQuestion);
            }

            // 冠詞問題生成ボタンのイベントリスナー
            const generateArticleBtn = document.getElementById('generateArticleQuestion');
            if (generateArticleBtn) {
                generateArticleBtn.addEventListener('click', generateArticleQuestion);
            }

            // be動詞問題生成ボタンのイベントリスナー
            const generateBeVerbBtn = document.getElementById('generateBeVerbQuestion');
            if (generateBeVerbBtn) {
                generateBeVerbBtn.addEventListener('click', generateBeVerbQuestion);
            }

            // 一般動詞問題生成ボタンのイベントリスナー
            const generateVerbBtn = document.getElementById('generateVerbQuestion');
            if (generateVerbBtn) {
                generateVerbBtn.addEventListener('click', generateVerbQuestion);
            }

            // 形容詞問題生成ボタンのイベントリスナー
            const generateAdjectiveBtn = document.getElementById('generateAdjectiveQuestion');
            if (generateAdjectiveBtn) {
                generateAdjectiveBtn.addEventListener('click', generateAdjectiveQuestion);
            }

            // 副詞問題生成ボタンのイベントリスナー
            const generateAdverbBtn = document.getElementById('generateAdverbQuestion');
            if (generateAdverbBtn) {
                generateAdverbBtn.addEventListener('click', generateAdverbQuestion);
            }

            // 前置詞問題生成ボタンのイベントリスナー
            const generatePrepositionBtn = document.getElementById('generatePrepositionQuestion');
            if (generatePrepositionBtn) {
                generatePrepositionBtn.addEventListener('click', generatePrepositionQuestion);
            }

            // 接続詞問題生成ボタンのイベントリスナー
            const generateConjunctionBtn = document.getElementById('generateConjunctionQuestion');
            if (generateConjunctionBtn) {
                generateConjunctionBtn.addEventListener('click', generateConjunctionQuestion);
            }

            // 第1文型問題生成ボタンのイベントリスナー
            const generatePattern1Btn = document.getElementById('generatePattern1Question');
            if (generatePattern1Btn) {
                generatePattern1Btn.addEventListener('click', generatePattern1Question);
            }

            // 第2文型問題生成ボタンのイベントリスナー
            const generatePattern2Btn = document.getElementById('generatePattern2Question');
            if (generatePattern2Btn) {
                generatePattern2Btn.addEventListener('click', generatePattern2Question);
            }

            // 第3文型問題生成ボタンのイベントリスナー
            const generatePattern3Btn = document.getElementById('generatePattern3Question');
            if (generatePattern3Btn) {
                generatePattern3Btn.addEventListener('click', generatePattern3Question);
            }

            // 第4文型問題生成ボタンのイベントリスナー
            const generatePattern4Btn = document.getElementById('generatePattern4Question');
            if (generatePattern4Btn) {
                generatePattern4Btn.addEventListener('click', generatePattern4Question);
            }

            // 第5文型問題生成ボタンのイベントリスナー
            const generatePattern5Btn = document.getElementById('generatePattern5Question');
            if (generatePattern5Btn) {
                generatePattern5Btn.addEventListener('click', generatePattern5Question);
            }

            // 第3文型受動態問題生成ボタンのイベントリスナー
            const generatePassive3Btn = document.getElementById('generatePassive3Question');
            if (generatePassive3Btn) {
                generatePassive3Btn.addEventListener('click', generatePassive3Question);
            }

            // 第4文型受動態問題生成ボタンのイベントリスナー
            const generatePassive4Btn = document.getElementById('generatePassive4Question');
            if (generatePassive4Btn) {
                generatePassive4Btn.addEventListener('click', generatePassive4Question);
            }

            // 第5文型受動態問題生成ボタンのイベントリスナー
            const generatePassive5Btn = document.getElementById('generatePassive5Question');
            if (generatePassive5Btn) {
                generatePassive5Btn.addEventListener('click', generatePassive5Question);
            }

            // 句の問題生成ボタンのイベントリスナー
            const generateGerundBtn = document.getElementById('generateGerundQuestion');
            if (generateGerundBtn) {
                generateGerundBtn.addEventListener('click', generateGerundQuestion);
            }

            const generateInfinitiveBtn = document.getElementById('generateInfinitiveQuestion');
            if (generateInfinitiveBtn) {
                generateInfinitiveBtn.addEventListener('click', generateInfinitiveQuestion);
            }

            const generateParticipleBtn = document.getElementById('generateParticipleQuestion');
            if (generateParticipleBtn) {
                generateParticipleBtn.addEventListener('click', generateParticipleQuestion);
            }

            const generateParticipleConstructionBtn = document.getElementById('generateParticipleConstructionQuestion');
            if (generateParticipleConstructionBtn) {
                generateParticipleConstructionBtn.addEventListener('click', generateParticipleConstructionQuestion);
            }

            // 節の問題生成ボタンのイベントリスナー
            const generateRelativePronounBtn = document.getElementById('generateRelativePronounQuestion');
            if (generateRelativePronounBtn) {
                generateRelativePronounBtn.addEventListener('click', generateRelativePronounQuestion);
            }

            const generateRelativeAdverbBtn = document.getElementById('generateRelativeAdverbQuestion');
            if (generateRelativeAdverbBtn) {
                generateRelativeAdverbBtn.addEventListener('click', generateRelativeAdverbQuestion);
            }

            const generateSubordinateConjunctionBtn = document.getElementById('generateSubordinateConjunctionQuestion');
            if (generateSubordinateConjunctionBtn) {
                generateSubordinateConjunctionBtn.addEventListener('click', generateSubordinateConjunctionQuestion);
            }

            const generateIndirectQuestionBtn = document.getElementById('generateIndirectQuestionQuestion');
            if (generateIndirectQuestionBtn) {
                generateIndirectQuestionBtn.addEventListener('click', generateIndirectQuestionQuestion);
            }

            // 時制の問題生成ボタンのイベントリスナー
            const generatePresentTenseBtn = document.getElementById('generatePresentTenseQuestion');
            if (generatePresentTenseBtn) {
                generatePresentTenseBtn.addEventListener('click', generatePresentTenseQuestion);
            }

            const generatePastTenseBtn = document.getElementById('generatePastTenseQuestion');
            if (generatePastTenseBtn) {
                generatePastTenseBtn.addEventListener('click', generatePastTenseQuestion);
            }

            const generateProgressiveTenseBtn = document.getElementById('generateProgressiveTenseQuestion');
            if (generateProgressiveTenseBtn) {
                generateProgressiveTenseBtn.addEventListener('click', generateProgressiveTenseQuestion);
            }

            const generatePresentPerfectBtn = document.getElementById('generatePresentPerfectQuestion');
            if (generatePresentPerfectBtn) {
                generatePresentPerfectBtn.addEventListener('click', generatePresentPerfectQuestion);
            }

            const generatePastPerfectBtn = document.getElementById('generatePastPerfectQuestion');
            if (generatePastPerfectBtn) {
                generatePastPerfectBtn.addEventListener('click', generatePastPerfectQuestion);
            }

            const generateFuturePerfectBtn = document.getElementById('generateFuturePerfectQuestion');
            if (generateFuturePerfectBtn) {
                generateFuturePerfectBtn.addEventListener('click', generateFuturePerfectQuestion);
            }

            // 助動詞の問題生成ボタンのイベントリスナー
            const generateCanBtn = document.getElementById('generateCanQuestion');
            if (generateCanBtn) {
                generateCanBtn.addEventListener('click', generateCanQuestion);
            }

            const generateWillBtn = document.getElementById('generateWillQuestion');
            if (generateWillBtn) {
                generateWillBtn.addEventListener('click', generateWillQuestion);
            }

            const generateMayBtn = document.getElementById('generateMayQuestion');
            if (generateMayBtn) {
                generateMayBtn.addEventListener('click', generateMayQuestion);
            }

            const generateMustBtn = document.getElementById('generateMustQuestion');
            if (generateMustBtn) {
                generateMustBtn.addEventListener('click', generateMustQuestion);
            }

            const generateShouldBtn = document.getElementById('generateShouldQuestion');
            if (generateShouldBtn) {
                generateShouldBtn.addEventListener('click', generateShouldQuestion);
            }

            // 仮定法の問題生成ボタンのイベントリスナー
            const generateSubjunctivePastBtn = document.getElementById('generateSubjunctivePastQuestion');
            if (generateSubjunctivePastBtn) {
                generateSubjunctivePastBtn.addEventListener('click', generateSubjunctivePastQuestion);
            }

            const generateSubjunctivePastPerfectBtn = document.getElementById('generateSubjunctivePastPerfectQuestion');
            if (generateSubjunctivePastPerfectBtn) {
                generateSubjunctivePastPerfectBtn.addEventListener('click', generateSubjunctivePastPerfectQuestion);
            }

            const generateSubjunctiveFutureBtn = document.getElementById('generateSubjunctiveFutureQuestion');
            if (generateSubjunctiveFutureBtn) {
                generateSubjunctiveFutureBtn.addEventListener('click', generateSubjunctiveFutureQuestion);
            }

            const generateSubjunctiveInversionBtn = document.getElementById('generateSubjunctiveInversionQuestion');
            if (generateSubjunctiveInversionBtn) {
                generateSubjunctiveInversionBtn.addEventListener('click', generateSubjunctiveInversionQuestion);
            }

            // 比較の問題生成ボタンのイベントリスナー
            const generateComparativeBtn = document.getElementById('generateComparativeQuestion');
            if (generateComparativeBtn) {
                generateComparativeBtn.addEventListener('click', generateComparativeQuestion);
            }

            const generateSuperlativeBtn = document.getElementById('generateSuperlativeQuestion');
            if (generateSuperlativeBtn) {
                generateSuperlativeBtn.addEventListener('click', generateSuperlativeQuestion);
            }

            const generatePositiveBtn = document.getElementById('generatePositiveQuestion');
            if (generatePositiveBtn) {
                generatePositiveBtn.addEventListener('click', generatePositiveQuestion);
            }
        });

        // 汎用AI問題生成関数
        async function generateQuestionForTopic(topic, generateBtnId, loadingIndicatorId, containerId, questionTextId, optionsContainerId, feedbackId) {
            const generateBtn = document.getElementById(generateBtnId);
            const loadingIndicator = document.getElementById(loadingIndicatorId);
            const aiQuestionContainer = document.getElementById(containerId);

            generateBtn.disabled = true;
            generateBtn.textContent = '生成中...';
            loadingIndicator.classList.remove('hidden');
            aiQuestionContainer.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/api/generate-question`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: topic,
                        difficulty: 'medium'
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Failed to generate question');
                }

                displayAIQuestion(result.data, containerId, questionTextId, optionsContainerId, feedbackId);

            } catch (error) {
                console.error('Error generating question:', error);
                alert('問題の生成に失敗しました。もう一度お試しください。');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = '新しい問題を生成';
                loadingIndicator.classList.add('hidden');
            }
        }

        // 文型の問題生成機能
        async function generatePattern1Question() {
            await generateQuestionForTopic('pattern1', 'generatePattern1Question', 'loadingPattern1Indicator', 'aiPattern1QuestionContainer', 'aiPattern1QuestionText', 'aiPattern1OptionsContainer', 'aiPattern1Feedback');
        }

        async function generatePattern2Question() {
            await generateQuestionForTopic('pattern2', 'generatePattern2Question', 'loadingPattern2Indicator', 'aiPattern2QuestionContainer', 'aiPattern2QuestionText', 'aiPattern2OptionsContainer', 'aiPattern2Feedback');
        }

        async function generatePattern3Question() {
            await generateQuestionForTopic('pattern3', 'generatePattern3Question', 'loadingPattern3Indicator', 'aiPattern3QuestionContainer', 'aiPattern3QuestionText', 'aiPattern3OptionsContainer', 'aiPattern3Feedback');
        }

        async function generatePattern4Question() {
            await generateQuestionForTopic('pattern4', 'generatePattern4Question', 'loadingPattern4Indicator', 'aiPattern4QuestionContainer', 'aiPattern4QuestionText', 'aiPattern4OptionsContainer', 'aiPattern4Feedback');
        }

        async function generatePattern5Question() {
            await generateQuestionForTopic('pattern5', 'generatePattern5Question', 'loadingPattern5Indicator', 'aiPattern5QuestionContainer', 'aiPattern5QuestionText', 'aiPattern5OptionsContainer', 'aiPattern5Feedback');
        }

        async function generatePassive3Question() {
            await generateQuestionForTopic('passive3', 'generatePassive3Question', 'loadingPassive3Indicator', 'aiPassive3QuestionContainer', 'aiPassive3QuestionText', 'aiPassive3OptionsContainer', 'aiPassive3Feedback');
        }

        async function generatePassive4Question() {
            await generateQuestionForTopic('passive4', 'generatePassive4Question', 'loadingPassive4Indicator', 'aiPassive4QuestionContainer', 'aiPassive4QuestionText', 'aiPassive4OptionsContainer', 'aiPassive4Feedback');
        }

        async function generatePassive5Question() {
            await generateQuestionForTopic('passive5', 'generatePassive5Question', 'loadingPassive5Indicator', 'aiPassive5QuestionContainer', 'aiPassive5QuestionText', 'aiPassive5OptionsContainer', 'aiPassive5Feedback');
        }
    </script>

</body>
</html>